{"version":3,"file":"react-svg.production.min.js","sources":["../src/shallow-differs.ts","../src/index.tsx"],"sourcesContent":["// Hat-tip: https://github.com/developit/preact-compat/blob/master/src/index.js#L402.\n\ninterface O {\n  [key: string]: any\n}\n\nconst shallowDiffers = (a: O, b: O) => {\n  for (const i in a) {\n    if (!(i in b)) {\n      return true\n    }\n  }\n\n  for (const i in b) {\n    if (a[i] !== b[i]) {\n      return true\n    }\n  }\n\n  return false\n}\n\nexport default shallowDiffers\n","import SVGInjector from '@tanem/svg-injector'\nimport * as PropTypes from 'prop-types'\nimport * as React from 'react'\nimport ReactDOMServer from 'react-dom/server'\nimport shallowDiffers from './shallow-differs'\n\nexport type OnInjected = (\n  error: Error | null,\n  svg: SVGSVGElement | undefined\n) => void\n\ninterface Props {\n  evalScripts: 'always' | 'once' | 'never'\n  fallback: React.ReactType\n  loading: React.ReactType\n  onInjected: OnInjected\n  renumerateIRIElements: boolean\n  src: string\n  svgClassName: string\n  svgStyle: React.CSSProperties\n}\n\ninterface State {\n  hasError: boolean\n  isLoading: boolean\n}\n\nexport default class ReactSVG extends React.Component<\n  Props &\n    React.DetailedHTMLProps<\n      React.HTMLAttributes<HTMLDivElement>,\n      HTMLDivElement\n    >,\n  State\n> {\n  static defaultProps = {\n    evalScripts: 'never',\n    fallback: null,\n    loading: null,\n    onInjected: () => undefined,\n    renumerateIRIElements: true,\n    svgClassName: null,\n    svgStyle: {}\n  }\n\n  static propTypes = {\n    evalScripts: PropTypes.oneOf(['always', 'once', 'never']),\n    fallback: PropTypes.oneOfType([\n      PropTypes.func,\n      PropTypes.object,\n      PropTypes.string\n    ]),\n    loading: PropTypes.oneOfType([\n      PropTypes.func,\n      PropTypes.object,\n      PropTypes.string\n    ]),\n    onInjected: PropTypes.func,\n    renumerateIRIElements: PropTypes.bool,\n    src: PropTypes.string.isRequired,\n    svgClassName: PropTypes.string,\n    svgStyle: PropTypes.object\n  }\n\n  initialState = {\n    hasError: false,\n    isLoading: true\n  }\n\n  state = this.initialState\n\n  container: HTMLDivElement | null | undefined\n\n  svgWrapper: HTMLDivElement | null | undefined\n\n  refCallback: React.Ref<HTMLDivElement> = container => {\n    this.container = container\n  }\n\n  renderSVG() {\n    if (this.container instanceof Node) {\n      const {\n        evalScripts,\n        onInjected,\n        renumerateIRIElements,\n        src,\n        svgClassName,\n        svgStyle\n      } = this.props\n\n      const div = document.createElement('div')\n      div.innerHTML = ReactDOMServer.renderToStaticMarkup(\n        <div>\n          <div className={svgClassName} data-src={src} style={svgStyle} />\n        </div>\n      )\n\n      this.svgWrapper = this.container.appendChild(\n        div.firstChild as HTMLDivElement\n      )\n\n      const each: OnInjected = (error, svg) => {\n        if (error) {\n          this.removeSVG()\n        }\n\n        this.setState(\n          () => ({\n            hasError: !!error,\n            isLoading: false\n          }),\n          () => {\n            onInjected(error, svg)\n          }\n        )\n      }\n\n      SVGInjector(this.svgWrapper.firstChild, {\n        each,\n        evalScripts,\n        renumerateIRIElements\n      })\n    }\n  }\n\n  removeSVG() {\n    if (this.container instanceof Node && this.svgWrapper instanceof Node) {\n      this.container.removeChild(this.svgWrapper)\n      this.svgWrapper = null\n    }\n  }\n\n  componentDidMount() {\n    this.renderSVG()\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (shallowDiffers(prevProps, this.props)) {\n      this.setState(\n        () => this.initialState,\n        () => {\n          this.removeSVG()\n          this.renderSVG()\n        }\n      )\n    }\n  }\n\n  componentWillUnmount() {\n    this.removeSVG()\n  }\n\n  render() {\n    const {\n      evalScripts,\n      fallback: Fallback,\n      loading: Loading,\n      onInjected,\n      renumerateIRIElements,\n      src,\n      svgClassName,\n      svgStyle,\n      ...rest\n    } = this.props\n\n    return (\n      <div {...rest} ref={this.refCallback}>\n        {this.state.isLoading && Loading && <Loading />}\n        {this.state.hasError && Fallback && <Fallback />}\n      </div>\n    )\n  }\n}\n"],"names":["shallowDiffers","a","b","i","ReactSVG","initialState","hasError","isLoading","state","_this","container","svgWrapper","refCallback","renderSVG","this","Node","props","evalScripts","onInjected","renumerateIRIElements","src","svgClassName","svgStyle","div","document","createElement","innerHTML","ReactDOMServer","renderToStaticMarkup","React.createElement","className","style","appendChild","firstChild","SVGInjector","each","error","svg","_this2","removeSVG","setState","removeChild","componentDidMount","componentDidUpdate","prevProps","_this3","componentWillUnmount","render","Fallback","fallback","Loading","loading","rest","ref","React","defaultProps"],"mappings":"sfAMMA,eAAiB,SAACC,EAAMC,OACvB,IAAMC,KAAKF,OACRE,KAAKD,UACF,MAIN,IAAMC,KAAKD,KACVD,EAAEE,KAAOD,EAAEC,UACN,SAIJ,GCQYC,6JAqCnBC,aAAe,CACbC,UAAU,EACVC,WAAW,KAGbC,MAAQC,EAAKJ,eAEbK,mBAEAC,oBAEAC,YAAyC,SAAAF,KAClCA,UAAYA,oDAGnBG,mCACMC,KAAKJ,qBAAqBK,KAAM,OAQ9BD,KAAKE,MANPC,IAAAA,YACAC,IAAAA,WACAC,IAAAA,sBACAC,IAAAA,IACAC,IAAAA,aACAC,IAAAA,SAGIC,EAAMC,SAASC,cAAc,OACnCF,EAAIG,UAAYC,eAAeC,qBAC7BC,+BACEA,2BAAKC,UAAWT,aAAwBD,EAAKW,MAAOT,WAInDX,WAAaG,KAAKJ,UAAUsB,YAC/BT,EAAIU,YAmBNC,YAAYpB,KAAKH,WAAWsB,WAAY,CACtCE,KAjBuB,SAACC,EAAOC,GAC3BD,GACFE,EAAKC,YAGPD,EAAKE,SACH,iBAAO,CACLlC,WAAY8B,EACZ7B,WAAW,IAEb,WACEW,EAAWkB,EAAOC,MAOtBpB,YAAAA,EACAE,sBAAAA,QAKNoB,qBACMzB,KAAKJ,qBAAqBK,MAAQD,KAAKH,sBAAsBI,YAC1DL,UAAU+B,YAAY3B,KAAKH,iBAC3BA,WAAa,SAItB+B,kCACO7B,eAGP8B,4BAAmBC,cACb5C,eAAe4C,EAAW9B,KAAKE,aAC5BwB,SACH,kBAAMK,EAAKxC,cACX,WACEwC,EAAKN,YACLM,EAAKhC,iBAMbiC,qCACOP,eAGPQ,wBAWMjC,KAAKE,MARGgC,KADV/B,cACAgC,UACSC,IAATC,QAMGC,KALHlC,aACAC,wBACAC,MACAC,eACAC,4JAKAO,sCAASuB,GAAMC,IAAKvC,KAAKF,cACtBE,KAAKN,MAAMD,WAAa2C,GAAWrB,oBAACqB,QACpCpC,KAAKN,MAAMF,UAAY0C,GAAYnB,oBAACmB,aA7IPM,iBAAjBlD,SAQZmD,aAAe,CACpBtC,YAAa,QACbgC,SAAU,KACVE,QAAS,KACTjC,WAAY,aACZC,uBAAuB,EACvBE,aAAc,KACdC,SAAU"}