{"version":3,"file":"react-svg.js","sources":["../src/shallow-differs.ts","../src/index.tsx"],"sourcesContent":["// Hat-tip: https://github.com/developit/preact-compat/blob/master/src/index.js#L402.\n\ninterface O {\n  [key: string]: any\n}\n\nconst shallowDiffers = (a: O, b: O) => {\n  for (const i in a) {\n    if (!(i in b)) {\n      return true\n    }\n  }\n\n  for (const i in b) {\n    if (a[i] !== b[i]) {\n      return true\n    }\n  }\n\n  return false\n}\n\nexport default shallowDiffers\n","import SVGInjector from '@tanem/svg-injector'\nimport * as PropTypes from 'prop-types'\nimport * as React from 'react'\nimport ReactDOMServer from 'react-dom/server'\nimport shallowDiffers from './shallow-differs'\n\nexport type OnInjected = (\n  error: Error | null,\n  svg: SVGSVGElement | undefined\n) => void\n\ninterface Props {\n  evalScripts: 'always' | 'once' | 'never'\n  fallback: React.ReactType\n  loading: React.ReactType\n  onInjected: OnInjected\n  renumerateIRIElements: boolean\n  src: string\n  svgClassName: string\n  svgStyle: React.CSSProperties\n}\n\ninterface State {\n  hasError: boolean\n  isLoading: boolean\n}\n\nexport default class ReactSVG extends React.Component<\n  Props &\n    React.DetailedHTMLProps<\n      React.HTMLAttributes<HTMLDivElement>,\n      HTMLDivElement\n    >,\n  State\n> {\n  static defaultProps = {\n    evalScripts: 'never',\n    fallback: null,\n    loading: null,\n    onInjected: () => undefined,\n    renumerateIRIElements: true,\n    svgClassName: null,\n    svgStyle: {}\n  }\n\n  static propTypes = {\n    evalScripts: PropTypes.oneOf(['always', 'once', 'never']),\n    fallback: PropTypes.oneOfType([\n      PropTypes.func,\n      PropTypes.object,\n      PropTypes.string\n    ]),\n    loading: PropTypes.oneOfType([\n      PropTypes.func,\n      PropTypes.object,\n      PropTypes.string\n    ]),\n    onInjected: PropTypes.func,\n    renumerateIRIElements: PropTypes.bool,\n    src: PropTypes.string.isRequired,\n    svgClassName: PropTypes.string,\n    svgStyle: PropTypes.object\n  }\n\n  initialState = {\n    hasError: false,\n    isLoading: true\n  }\n\n  state = this.initialState\n\n  container: HTMLDivElement | null | undefined\n\n  svgWrapper: HTMLDivElement | null | undefined\n\n  refCallback: React.Ref<HTMLDivElement> = container => {\n    this.container = container\n  }\n\n  renderSVG() {\n    if (this.container instanceof Node) {\n      const {\n        evalScripts,\n        onInjected,\n        renumerateIRIElements,\n        src,\n        svgClassName,\n        svgStyle\n      } = this.props\n\n      const div = document.createElement('div')\n      div.innerHTML = ReactDOMServer.renderToStaticMarkup(\n        <div>\n          <div className={svgClassName} data-src={src} style={svgStyle} />\n        </div>\n      )\n\n      this.svgWrapper = this.container.appendChild(\n        div.firstChild as HTMLDivElement\n      )\n\n      const each: OnInjected = (error, svg) => {\n        if (error) {\n          this.removeSVG()\n        }\n\n        this.setState(\n          () => ({\n            hasError: !!error,\n            isLoading: false\n          }),\n          () => {\n            onInjected(error, svg)\n          }\n        )\n      }\n\n      SVGInjector(this.svgWrapper.firstChild, {\n        each,\n        evalScripts,\n        renumerateIRIElements\n      })\n    }\n  }\n\n  removeSVG() {\n    if (this.container instanceof Node && this.svgWrapper instanceof Node) {\n      this.container.removeChild(this.svgWrapper)\n      this.svgWrapper = null\n    }\n  }\n\n  componentDidMount() {\n    this.renderSVG()\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (shallowDiffers(prevProps, this.props)) {\n      this.setState(\n        () => this.initialState,\n        () => {\n          this.removeSVG()\n          this.renderSVG()\n        }\n      )\n    }\n  }\n\n  componentWillUnmount() {\n    this.removeSVG()\n  }\n\n  render() {\n    const {\n      evalScripts,\n      fallback: Fallback,\n      loading: Loading,\n      onInjected,\n      renumerateIRIElements,\n      src,\n      svgClassName,\n      svgStyle,\n      ...rest\n    } = this.props\n\n    return (\n      <div {...rest} ref={this.refCallback}>\n        {this.state.isLoading && Loading && <Loading />}\n        {this.state.hasError && Fallback && <Fallback />}\n      </div>\n    )\n  }\n}\n"],"names":["shallowDiffers","a","b","i","ReactSVG","initialState","hasError","isLoading","state","container","svgWrapper","refCallback","renderSVG","Node","props","evalScripts","onInjected","renumerateIRIElements","src","svgClassName","svgStyle","div","document","createElement","innerHTML","ReactDOMServer","renderToStaticMarkup","React.createElement","appendChild","firstChild","each","error","svg","removeSVG","setState","SVGInjector","removeChild","componentDidMount","componentDidUpdate","prevProps","componentWillUnmount","render","Fallback","fallback","Loading","loading","rest","React","defaultProps","undefined","propTypes","PropTypes","isRequired"],"mappings":";;;;;;;;AAAA;AAMA,IAAMA,cAAc,GAAG,SAAjBA,cAAiB,CAACC,CAAD,EAAOC,CAAP,EAAgB;OAChC,IAAMC,CAAX,IAAgBF,CAAhB,EAAmB;QACb,EAAEE,CAAC,IAAID,CAAP,CAAJ,EAAe;aACN,IAAP;;;;OAIC,IAAMC,EAAX,IAAgBD,CAAhB,EAAmB;QACbD,CAAC,CAACE,EAAD,CAAD,KAASD,CAAC,CAACC,EAAD,CAAd,EAAmB;aACV,IAAP;;;;SAIG,KAAP;CAbF;;ICqBqBC;;;;;;;;;;;;;UAqCnBC,eAAe;MACbC,QAAQ,EAAE,KADG;MAEbC,SAAS,EAAE;;UAGbC,QAAQ,MAAKH;UAEbI;UAEAC;;UAEAC,cAAyC,UAAAF,SAAS,EAAI;YAC/CA,SAAL,GAAiBA,SAAjB;;;;;;;;SAGFG,iCAAY;;;QACN,KAAKH,SAAL,YAA0BI,IAA9B,EAAoC;wBAQ9B,KAAKC,KARyB;UAEhCC,YAFgC,eAEhCA,WAFgC;UAGhCC,WAHgC,eAGhCA,UAHgC;UAIhCC,sBAJgC,eAIhCA,qBAJgC;UAKhCC,IALgC,eAKhCA,GALgC;UAMhCC,aANgC,eAMhCA,YANgC;UAOhCC,SAPgC,eAOhCA,QAPgC;UAU5BC,GAAG,GAAGC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAZ;MACAF,GAAG,CAACG,SAAJ,GAAgBC,cAAc,CAACC,oBAAf,CACdC,2BACEA;QAAK,SAAS,EAAER,aAAhB;oBAAwCD,IAAxC;QAA6C,KAAK,EAAEE;QADtD,CADc,CAAhB;WAMKV,UAAL,GAAkB,KAAKD,SAAL,CAAemB,WAAf,CAChBP,GAAG,CAACQ,UADY,CAAlB;;UAIMC,IAAgB,GAAG,SAAnBA,IAAmB,CAACC,KAAD,EAAQC,GAAR,EAAgB;YACnCD,KAAJ,EAAW;UACT,MAAI,CAACE,SAAL;;;QAGF,MAAI,CAACC,QAAL,CACE;iBAAO;YACL5B,QAAQ,EAAE,CAAC,CAACyB,KADP;YAELxB,SAAS,EAAE;WAFb;SADF,EAKE,YAAM;UACJS,WAAU,CAACe,KAAD,EAAQC,GAAR,CAAV;SANJ;OALF;;MAgBAG,WAAW,CAAC,KAAKzB,UAAL,CAAgBmB,UAAjB,EAA6B;QACtCC,IAAI,EAAJA,IADsC;QAEtCf,WAAW,EAAXA,YAFsC;QAGtCE,qBAAqB,EAArBA;OAHS,CAAX;;;;SAQJgB,iCAAY;QACN,KAAKxB,SAAL,YAA0BI,IAA1B,IAAkC,KAAKH,UAAL,YAA2BG,IAAjE,EAAuE;WAChEJ,SAAL,CAAe2B,WAAf,CAA2B,KAAK1B,UAAhC;WACKA,UAAL,GAAkB,IAAlB;;;;SAIJ2B,iDAAoB;SACbzB,SAAL;;;SAGF0B,iDAAmBC,WAAkB;;;QAC/BvC,cAAc,CAACuC,SAAD,EAAY,KAAKzB,KAAjB,CAAlB,EAA2C;WACpCoB,QAAL,CACE;eAAM,MAAI,CAAC7B,YAAX;OADF,EAEE,YAAM;QACJ,MAAI,CAAC4B,SAAL;;QACA,MAAI,CAACrB,SAAL;OAJJ;;;;SAUJ4B,uDAAuB;SAChBP,SAAL;;;SAGFQ,2BAAS;uBAWH,KAAK3B,KAXF;QAELC,WAFK,gBAELA,WAFK;QAGK2B,QAHL,gBAGLC,QAHK;QAIIC,OAJJ,gBAILC,OAJK;QAKL7B,UALK,gBAKLA,UALK;QAMLC,qBANK,gBAMLA,qBANK;QAOLC,GAPK,gBAOLA,GAPK;QAQLC,YARK,gBAQLA,YARK;QASLC,QATK,gBASLA,QATK;QAUF0B,IAVE;;WAcLnB,kCAASmB,IAAT;MAAe,GAAG,EAAE,KAAKnC;QACtB,KAAKH,KAAL,CAAWD,SAAX,IAAwBqC,OAAxB,IAAmCjB,cAAC,OAAD,OADtC,EAEG,KAAKnB,KAAL,CAAWF,QAAX,IAAuBoC,QAAvB,IAAmCf,cAAC,QAAD,OAFtC,CADF;;;;EA1IkCoB;;AAAjB3C,SAQZ4C,eAAe;EACpBjC,WAAW,EAAE,OADO;EAEpB4B,QAAQ,EAAE,IAFU;EAGpBE,OAAO,EAAE,IAHW;EAIpB7B,UAAU,EAAE;WAAMiC,SAAN;GAJQ;EAKpBhC,qBAAqB,EAAE,IALH;EAMpBE,YAAY,EAAE,IANM;EAOpBC,QAAQ,EAAE;;AAfOhB,SAkBZ8C,oDAAY;EACjBnC,WAAW,EAAEoC,KAAA,CAAgB,CAAC,QAAD,EAAW,MAAX,EAAmB,OAAnB,CAAhB,CADI;EAEjBR,QAAQ,EAAEQ,SAAA,CAAoB,CAC5BA,IAD4B,EAE5BA,MAF4B,EAG5BA,MAH4B,CAApB,CAFO;EAOjBN,OAAO,EAAEM,SAAA,CAAoB,CAC3BA,IAD2B,EAE3BA,MAF2B,EAG3BA,MAH2B,CAApB,CAPQ;EAYjBnC,UAAU,EAAEmC,IAZK;EAajBlC,qBAAqB,EAAEkC,IAbN;EAcjBjC,GAAG,EAAEiC,MAAA,CAAiBC,UAdL;EAejBjC,YAAY,EAAEgC,MAfG;EAgBjB/B,QAAQ,EAAE+B;;;;;"}